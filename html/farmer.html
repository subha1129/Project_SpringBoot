<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Farmer Lookup</title>

    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #e3f2fd, #fce4ec);
            padding: 40px;
        }
        .main-container {
            max-width: 950px;
            margin: auto;
            padding: 30px;
            background: #ffffffcc;
            backdrop-filter: blur(8px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .result {
            display: none;
        }
    </style>
</head>
<body>

<div class="main-container">

    <!-- Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
        <h2 class="mb-3 mb-md-0">Farmer Details Lookup</h2>
        <button class="btn btn-success px-4 py-2 fw-semibold" onclick="goToAccount()">Create Account</button>
    </div>

    <!-- Two Columns -->
    <div class="row g-3">

        <!-- Search by ID -->
        <div class="col-md-6">
            <div class="p-3 rounded shadow-sm bg-white">
                <h4 class="text-primary mb-3">Search by Farmer ID</h4>
                <input type="number" class="form-control mb-3" id="farmerIdInput" placeholder="Enter Farmer ID" />
                <button class="btn btn-primary w-100" onclick="getFarmer()">Search</button>
            </div>
        </div>

        <!-- Search by Mobile -->
        <div class="col-md-6">
            <div class="p-3 rounded shadow-sm bg-white">
                <h4 class="text-primary mb-3">Search by Mobile Number</h4>
                <input type="text" class="form-control mb-3" id="mobileInput" placeholder="Enter Mobile Number" />
                <button class="btn btn-primary w-100" onclick="getFarmerByMobile()">Search</button>
            </div>
        </div>

    </div>

    <!-- Result Table -->
    <div id="result" class="result mt-4 p-3 border-start border-primary border-4 bg-white shadow-sm rounded">
    </div>

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    async function getFarmer() {
     const idInput = document.getElementById("farmerIdInput");
     const id = idInput.value;
     const resultBox = document.getElementById("result");

     if (!id) return alert("Please enter a valid Farmer ID.");

     try {
         const response = await fetch(`http://localhost:8080/farmer/id/${id}`);
         if (!response.ok) {
             resultBox.style.display = "block";
             resultBox.innerHTML =
                 `<p class='text-danger fw-bold'>Error: Unable to fetch data (Status ${response.status})</p>`;
             return;
         }

         const data = await response.json();
         showResult(data);

         idInput.value = ""; // ✅ Clear input AFTER getting result

     } catch {
         resultBox.style.display = "block";
         resultBox.innerHTML =
             "<p class='text-danger fw-bold'>Failed to connect to API.</p>";
     }
 }

 async function getFarmerByMobile() {
     const mobileInput = document.getElementById("mobileInput");
     const mobile = mobileInput.value;
     const resultBox = document.getElementById("result");

     if (!mobile) return alert("Please enter a mobile number.");

     try {
         const response = await fetch(`http://localhost:8080/farmer/mobile/${mobile}`);
         if (!response.ok) {
             resultBox.style.display = "block";
             resultBox.innerHTML =
                 `<p class='text-danger fw-bold'>Error: Unable to fetch data (Status ${response.status})</p>`;
             return;
         }

         const data = await response.json();
         showResult(data);

         mobileInput.value = ""; // ✅ Clear input AFTER getting result

     } catch {
         resultBox.style.display = "block";
         resultBox.innerHTML =
             "<p class='text-danger fw-bold'>Failed to connect to API.</p>";
     }
 }

     function showResult(data) {
         const resultBox = document.getElementById("result");

         let html = `
         <table class="table table-bordered table-striped table-hover">
             <tbody>`;

         Object.keys(data).forEach(key => {
             html += `
                 <tr>
                     <th class="bg-light" style="width:35%">${key}</th>
                     <td>${data[key] ?? '-'}</td>
                 </tr>`;
         });

         html += `</tbody></table>`;

         resultBox.style.display = "block";
         resultBox.innerHTML = html;
     }

     function goToAccount() {
         window.location.href = "account.html";
     }
</script>

</body>
</html>